<html>

<head>
<meta name=Generator content="Microsoft Office HTML Filter 2.0">
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Originator content="Microsoft Word 9">
<title> </title>
<style>
<!--
 
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{
	margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman";}
h1
	{
	margin:0in;
	margin-bottom:.0001pt;
	text-align:center;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Times New Roman";
	color:red;
	font-weight:normal;}
h2
	{
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.4in;
	text-indent:-.4in;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:Arial;
	font-style:italic;}
h3
	{
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.5in;
	text-indent:-.5in;
	page-break-after:avoid;
	font-size:13.0pt;
	font-family:Arial;}
h4
	{
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.6in;
	text-indent:-.6in;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Times New Roman";}
h5
	{
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.7in;
	text-indent:-.7in;
	font-size:13.0pt;
	font-family:"Times New Roman";
	font-style:italic;}
h6
	{
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.8in;
	text-indent:-.8in;
	font-size:11.0pt;
	font-family:"Times New Roman";}
p.MsoHeading7, li.MsoHeading7, div.MsoHeading7
	{
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.9in;
	text-indent:-.9in;
	font-size:12.0pt;
	font-family:"Times New Roman";}
p.MsoHeading8, li.MsoHeading8, div.MsoHeading8
	{
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:1.0in;
	text-indent:-1.0in;
	font-size:12.0pt;
	font-family:"Times New Roman";
	font-style:italic;}
p.MsoHeading9, li.MsoHeading9, div.MsoHeading9
	{
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:1.1in;
	text-indent:-1.1in;
	font-size:11.0pt;
	font-family:Arial;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman";}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman";}
p.MsoPlainText, li.MsoPlainText, div.MsoPlainText
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New";}
p.HeaderSep, li.HeaderSep, div.HeaderSep
	{
	margin:0in;
	margin-bottom:.0001pt;
	background:#88942C;
	font-size:10.0pt;
	font-family:"Courier New";}
p.Divider, li.Divider, div.Divider
	{
	margin:0in;
	margin-bottom:.0001pt;
	background:teal;
	font-size:10.0pt;
	font-family:"Courier New";}
p.DispTxt, li.DispTxt, div.DispTxt
	{
	margin-top:0in;
	margin-right:.1in;
	margin-bottom:6.0pt;
	margin-left:.1in;
	text-align:justify;
	font-size:10.0pt;
	font-family:Arial;}
p.CopyNPasteLabel, li.CopyNPasteLabel, div.CopyNPasteLabel
	{
	margin:0in;
	margin-bottom:.0001pt;
	text-indent:0in;
	font-size:10.0pt;
	font-family:"Courier New";}
p.syntax, li.syntax, div.syntax
	{
	margin-top:0in;
	margin-right:.3in;
	margin-bottom:0in;
	margin-left:.3in;
	margin-bottom:.0001pt;
	page-break-after:avoid;
	font-size:10.0pt;
	font-family:"Courier New";
	color:navy;
	font-weight:bold;}
p.argDef, li.argDef, div.argDef
	{
	margin-top:0in;
	margin-right:.3in;
	margin-bottom:0in;
	margin-left:1.1in;
	margin-bottom:.0001pt;
	text-indent:-.8in;
	font-size:10.0pt;
	font-family:"Courier New";
	color:blue;
	font-weight:bold;}
p.syntaxDesc, li.syntaxDesc, div.syntaxDesc
	{
	margin-top:0in;
	margin-right:.3in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	text-align:justify;
	font-size:10.0pt;
	font-family:"Courier New";
	color:green;
	font-weight:bold;}
p.return, li.return, div.return
	{
	margin-top:6.0pt;
	margin-right:.3in;
	margin-bottom:6.0pt;
	margin-left:1.0in;
	text-align:justify;
	text-indent:-.7in;
	page-break-after:avoid;
	font-size:10.0pt;
	font-family:"Courier New";
	color:#003300;
	font-weight:bold;}
p.example, li.example, div.example
	{
	margin-top:6.0pt;
	margin-right:.3in;
	margin-bottom:0in;
	margin-left:.3in;
	margin-bottom:.0001pt;
	page-break-after:avoid;
	font-size:10.0pt;
	font-family:"Courier New";
	color:navy;
	font-weight:bold;}
p.gVar, li.gVar, div.gVar
	{
	margin-top:0in;
	margin-right:.3in;
	margin-bottom:0in;
	margin-left:2.0in;
	margin-bottom:.0001pt;
	text-indent:-1.7in;
	font-size:10.0pt;
	font-family:"Courier New";
	color:olive;
	font-weight:bold;}
p.codeExample, li.codeExample, div.codeExample
	{
	margin-top:0in;
	margin-right:.2in;
	margin-bottom:0in;
	margin-left:.6in;
	margin-bottom:.0001pt;
	text-align:justify;
	font-size:10.0pt;
	font-family:"Courier New";
	color:purple;
	font-weight:bold;}
p.heading, li.heading, div.heading
	{
	margin:0in;
	margin-bottom:.0001pt;
	page-break-after:avoid;
	font-size:12.0pt;
	font-family:"Times New Roman";
	color:#3D831D;
	font-weight:bold;}
p.codeOutputExample, li.codeOutputExample, div.codeOutputExample
	{
	margin-top:0in;
	margin-right:.2in;
	margin-bottom:0in;
	margin-left:.6in;
	margin-bottom:.0001pt;
	text-align:justify;
	font-size:10.0pt;
	font-family:"Courier New";
	color:teal;
	font-weight:bold;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
</head>

<body lang=EN-US>

<div class=Section1>

<p class=MsoNormal>&nbsp;</p>

<p class=HeaderSep>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<p class=heading>vimsh and vimsh.bat</p>

<p class=MsoNormal>&nbsp;</p>

<p class=DispTxt><b><span style='color:
#333399'>vimsh</span></b> and <b><span style='color:#333399'>vimsh.bat</span></b>
are simple <b><span style='color:#333399'>Vim script</span></b> shell command
line interpreters for <b><span style='color:#333399'>UNIX</span></b> and <b><span
style='color:#333399'>MSDOS</span></b> respectively.  You type <b><span style='color:#333399'>Vim script</span></b>
code into a <b><span style='color:#333399'>.vimsh</span></b> file then, using
the appropriate interpreter, execute the file from the command line.  <span style='color:black'> The interpreter </span>takes this code and
encapsulates it into a <b><span style='color:#333399'>Vim</span></b> <b><span
style='color:#333399'>script</span> <span style='color:#333399'>function</span></b>
and calls the function, capturing any output and echo-ing it to the shell
command line.</p>

<p class=DispTxt>&nbsp;</p>

<p class=Divider>&nbsp;</p>

<p class=heading>&nbsp;</p>

<p class=heading>The .vimsh file</p>

<p class=heading>&nbsp;</p>

<p class=DispTxt>The structure of a <b><span style='color:#333399'>.vimsh</span></b>
file is simple and analogous to other interpreted script files in <b><span
style='color:#333399'>UNIX</span></b>. 
It consists of a single header line identifying the file as an
executable script with ‘<b><span style='color:maroon'>vimsh</span></b>’ as the
interpreter (this is not needed with <b><span style='color:#333399'>MSDOS</span></b>,
however, the line is still included for uniformity across platforms and the MSDOS
interpreter expects it as does the <b><span style='color:#333399'>UNIX</span></b>
interpreter).  As an example:</p>

<p class=DispTxt>&nbsp;</p>

<p class=codeExample>#!/usr/local/bin/vimsh</p>

<p class=codeExample>let nr=1</p>

<p class=codeExample>echo ‘Counting to 10…’</p>

<p class=codeExample>echo ‘’</p>

<p class=codeExample>while nr &lt;= 10</p>

<p class=codeExample>  echon nr.’ ‘</p>

<p class=codeExample>  let nr=nr+1</p>

<p class=codeExample>endwhile</p>

<p class=codeExample>echo ‘Done’</p>

<p class=DispTxt>&nbsp;</p>

<p class=DispTxt>In <b><span style='color:#333399'>UNIX</span></b> the shell
looks at the first line for the name of an interpreter in script files.  It hands off the file to that interpreter,
in this case ‘<b><span style='color:maroon'>vimsh</span></b>’ (in <b><span
style='color:#333399'>MSDOS</span></b>, the mechanism is quite different, but
the outcome is the same, more about that later).  The interpreter then parses the script, executes the code, and
displays the results.  This is exactly
what happens with <b><span style='color:maroon'>vimsh</span></b><span
style='color:black'>.</span></p>

<p class=DispTxt>Here, the output would be:</p>

<p class=DispTxt>&nbsp;</p>

<p class=codeOutputExample>Counting to 10…</p>

<p class=codeOutputExample>1 2 3 4 5 6 7 8 9 10</p>

<p class=codeOutputExample>Done</p>

<p class=MsoPlainText>&nbsp;</p>

<p class=MsoPlainText>&nbsp;</p>

<p class=Divider>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoHeader>&nbsp;</p>

<p class=heading>Unix Setup</p>

<p class=DispTxt>&nbsp;</p>

<p class=DispTxt>Setup in <b><span style='color:#333399'>UNIX</span></b> is
quite easy.  Simply place the <b><span
style='color:#333399'>sh</span></b> version of <b><span style='color:maroon'>vimsh</span></b>
(<b><span style='color:maroon'>vimsh</span></b>) in a directory in your <b><span
style='color:#333399'>$PATH</span></b>. 
Now, any <b><span style='color:#333399'>.vimsh</span></b> file the shell
recognizes as an executable script (i.e., it resides somewhere in $PATH, has
its mode set to executable, and has <b><span style='color:maroon'>vimsh</span></b>
designated as the command line interpreter in its first line) will have its <b><span
style='color:#333399'>Vim script</span></b> code interpreted, executed, and the
results displayed.</p>

<p class=DispTxt>&nbsp;</p>

<span style='font-size:10.0pt;font-family:"Courier New";'><br clear=all style='page-break-before:
always'>
</span>

<p class=Divider>&nbsp;</p>

<p class=DispTxt>&nbsp;</p>

<p class=heading>MSDOS Setup</p>

<p class=heading>&nbsp;</p>

<p class=DispTxt>Setup for <b><span style='color:#333399'>MSDOS</span></b> is a
little more involved.  Besides placing
the <b><span style='color:#333399'>bat</span></b> version of <b><span
style='color:maroon'>vimsh</span></b> (<b><span style='color:maroon'>vimsh.bat</span></b>)
in a directory in your <b><span style='color:#333399'>%PATH</span></b>, you
must also tell <b><span style='color:#333399'>MSDOS</span></b> what sort of
files <b><span style='color:maroon'>vimsh</span></b> is associated with.  Unfortunately, Microsoft is not completely
clear on how this is done on all Windows platforms, but this method seems to
work okay.  First use the <b><span
style='color:#333399'>ASSOC</span></b> command to associate the <b><span
style='color:#333399'>.vimsh</span></b> file extension with a ‘<b><span
style='color:#333399'>file type</span></b>’:</p>

<p class=DispTxt>&nbsp;</p>

<p class=codeExample>ASSOC .vimsh=VimShellScript</p>

<p class=DispTxt>&nbsp;</p>

<p class=DispTxt>Then use the <b><span style='color:#333399'>FTYPE</span></b>
command to associate the ‘<b><span style='color:#333399'>file type</span></b>’
with a command for <b><span style='color:#333399'>cmd.exe</span></b> to
execute:</p>

<p class=DispTxt>&nbsp;</p>

<p class=codeExample>FTYPE VimShellScript=C:\&lt;your-location&gt;\vimsh.bat
“%1”</p>

<p class=DispTxt>&nbsp;</p>

<p class=DispTxt>Now any file located in <b><span style='color:#333399'>%PATH</span></b>
that has a <b><span style='color:#333399'>.vimsh</span></b> extension will be
identified as a <b><span style='color:green'>VimShellScript</span></b> and
associated with the command ‘<span style='color:purple'>C:\&lt;your-location&gt;\vimsh.bat
“%1”</span>’.  Here ‘<span
style='color:purple'>&lt;your-location&gt;</span><span style='color:black'>’</span>
is wherever you chose to place <b><span style='color:maroon'>vimsh.bat</span></b>.  Now for 2 comments about spaces in pathnames
in Microsoft file systems.  <b><span
style='color:red'>1) WATCH THEM</span></b>. 
<b><span style='color:red'>2) WATCH THEM</span></b> <b><span
style='color:red'>CAREFULLY</span></b>. 
Although Microsoft says they support spaces in pathnames (and by and
large, they do) there are ‘holes’ where they slip through.  Mostly, these holes deal with
arguments.  So, firstly, for <span
style='color:purple'>&lt;your-location&gt;</span>, theoretically a path (say
‘C:\Documents and Settings\Dave’) with spaces is allowed, however, you’re
better off (because of exceptions) to not use a path with spaces.  Secondly, the double quotes around <span
style='color:purple'>%1</span> are there for exactly that reason; to protect
any paths that have spaces.  Don’t leave
them out.</p>

<p class=DispTxt>You can also eliminate the need for typing the extension
(however, not the actual need for the extension in the file’s name) by
modifying <b><span style='color:#333399'>%PATHEXT</span></b>.  You can do this in the <b><span
style='color:#333399'>autoexec</span></b>, if your system uses one, or if
autoexec is not used, in the <b><span style='color:#333399'>Control Panel</span></b>
‘<b><span style='color:#333399'>System</span></b>’ menu under ‘<b><span
style='color:#333399'>Advanced</span></b>’ and ‘<b><span style='color:#333399'>Environment
Variables</span></b>’.  Either edit the
Control Panel entry, or append ‘<b><span style='color:#333399'>.vimsh</span></b>’
to <b><span style='color:#333399'>PATHEXT</span></b> in the autoexec:</p>

<p class=DispTxt>&nbsp;</p>

<p class=codeExample>SET PATHEXT=%PATHEXT%;.vimsh</p>

<p class=MsoHeader>&nbsp;</p>

<p class=Divider>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<p class=heading>Script
Execution</p>

<p class=DispTxt>&nbsp;</p>

<p class=DispTxt>Script execution is accomplished the same as any other
executable script, that is, by invoking the script name.  For example, in the example scripts in this
package there is a script named ‘<b><span style='color:#333399'>vimtest.vimsh</span></b>’.  On either platform, providing of course the
script is suitably located, you simply type:</p>

<p class=DispTxt>&nbsp;</p>

<p class=codeExample>vimtest.vimsh</p>

<p class=DispTxt>&nbsp;</p>

<p class=DispTxt>on the command line. 
Note that in <b><span style='color:#333399'>UNIX</span></b>, the script
can have any extension (or none) since it is the first line of the script that
defines how it is to be interpreted and executed.  This is not the case in <b><span style='color:#333399'>MSDOS</span></b>,
however, as that system uses file extensions to determine how a file is to be
interpreted and/or executed.  As
described above, you can at least eliminate the need to type the extension in <b><span
style='color:#333399'>MSDOS</span></b> by defining the extension in <b><span
style='color:#333399'>%PATHEXT</span></b><span style='color:black'>.</span></p>

<p class=MsoHeader>&nbsp;</p>

<span style='font-size:10.0pt;font-family:"Courier New";'><br clear=all style='page-break-before:
always'>
</span>

<p class=Divider>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<p class=heading>Script file
content</p>

<p class=DispTxt>&nbsp;</p>

<p class=DispTxt>The content of the script file can be any Vim script
code.  There are a couple of caveats,
however, and these deal with shell escape commands in Vim.  These can be a part of the script, but they
cannot be embedded.  That is, escapes to
the shell to execute commands must be standalone, they cannot be part of a Vim
script construct such as a loop or a function, etc.  This is because the interpreter executes them separately, so any
embedding would disrupt code flow causing vimsh to ‘freeze’.  Also, their output is not captured by the
interpreter, but rather left as placed by execution in the shell.  This being the case, their output may not
always occur ‘as formatted’ by your code.</p>

<p class=DispTxt>&nbsp;</p>

<p class=Divider>&nbsp;</p>

<p class=DispTxt>&nbsp;</p>

<p class=heading>Using Arguments</p>

<p class=DispTxt>&nbsp;</p>

<p class=DispTxt>Arguments can be passed to the script on the command line in
the usual fashion with pretty much the same caveats as other executable
scripts. For example, in <b><span style='color:#333399'>MSDOS</span></b>, when
quoting is needed, it is double quotes. 
An easy example is from the <b><span style='color:purple'>counting.vimsh</span></b>
script.  Without arguments, it issues a
terse usage message.</p>

<p class=codeExample>&nbsp;</p>

<p class=codeExample>counting.vimsh</p>

<p class=codeExample>&nbsp;</p>

<p class=codeOutputExample>Usage: counting.vimsh fromNr toNr</p>

<p class=codeOutputExample>  Counts from
'fromNr' to 'toNr'</p>

<p class=codeOutputExample style='margin-left:0in'>&nbsp;</p>

<p class=DispTxt>With arguments supplied.</p>

<p class=DispTxt>&nbsp;</p>

<p class=codeExample>counting.vimsh 12 3</p>

<p class=codeExample>&nbsp;</p>

<p class=codeOutputExample>Counting from 12 to 3</p>

<p class=codeOutputExample>12 11 10 9 8 7 6 5 4 3</p>

<p class=codeOutputExample>Done</p>

<p class=codeOutputExample>&nbsp;</p>

<p class=DispTxt>Arguments are supplied to the script via a mechanism similar
to the variable argument mechanism in <b><span style='color:#333399'>Vim script</span></b>
functions.  In functions these arguments
are specified as <b><span style='color:green'>a:1</span></b>, <b><span
style='color:green'>a:2</span></b>, …, <b><span style='color:green'>a:n</span></b>
with <b><span style='color:green'>a:0</span></b> holding the argument
count.  <b><span style='color:maroon'>vimsh</span></b>
passes the arguments identically, except they are globals, i.e., <b><span
style='color:red'>g:1</span></b>, <b><span style='color:red'>g:2</span></b>, …,
<b><span style='color:red'>g:n</span></b> with <b><span style='color:red'>g:0</span></b>
holding the argument count.</p>

<p class=DispTxt>Also, for special cases, notably when <b><span
style='color:#333399'>Vim</span></b> commands/functions (usually user defined)
are executed silently, within <b><span style='color:#333399'>Vim</span></b>
messages are suppressed from appearing on the command line.  However, they are not eliminated and are
gathered up by general redirection. 
Frequently you do not want this output, so <b><span style='color:maroon'>vimsh</span></b>
has a global return value you can set, <b><span style='color:red'>g:Ret</span></b>.  If this variable exists when <b><span
style='color:maroon'>vimsh</span></b> is run, the script’s returned output is
displayed instead of the normal redirection <b><span style='color:maroon'>vimsh</span></b>
uses.  See the script <b><span
style='color:purple'>vimgrep.vimsh</span></b> for an example.</p>

<p class=DispTxt>The output from the last <b><span style='color:maroon'>vimsh</span></b>
script executed is placed in the file <span style='color:green'>~/.vimsh.out</span>.  This is handy as in some cases, due to
terminal interfaces with <b><span style='color:#333399'>Vim</span></b>, the
displayed output may contain control characters, and command line redirection
is not always optimal.  The contents of
this file are ‘raw’ in that they have no special terminal escape
sequences.  To see this, try executing
the script <b><span style='color:purple'>vimgrep.vimsh</span></b> with command
line redirection and compare the contents of the redirected file with the
contents of <span style='color:green'>~/.vimsh.out</span>.  I ran this in a <b><span style='color:#333399'>cygwin</span></b>
<b><span style='color:#333399'>DOS command prompt window</span></b> running a <b><span
style='color:#333399'>bash</span></b> <b><span style='color:#333399'>login
shell</span></b>.</p>

<p class=DispTxt>&nbsp;</p>

<p class=codeExample>vimgrep.vimsh ‘indent $VIMRUNTIME/indent/*.vim –t’
&gt;vimgrep.out</p>

<p class=codeExample>&nbsp;</p>

<p class=codeExample>&nbsp;</p>

<p class=codeExample>&nbsp;</p>

<p class=codeOutputExample>-rw-r--r--   
1 Dave     None        52827 Aug 27 12:06 .vimsh.out</p>

<p class=codeOutputExample>-rw-r--r--   
1 Dave     None        55481 Aug 27 12:06 vimgrep.out</p>

<p class=codeOutputExample>&nbsp;</p>

<p class=DispTxt>Control character escape sequences and garbage replaced the
first (empty) line of the file and 2 lines of control character escape
sequences were added to the end.</p>

<p class=DispTxt>&nbsp;</p>

<p class=Divider>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<p class=codeExample>&nbsp;</p>

<p class=DispTxt>The package contains example scripts that illustrate shell
escapes, requesting input, and processing arguments.</p>

<p class=MsoHeader>&nbsp;</p>

<p class=MsoPlainText>&nbsp;</p>

<p class=MsoPlainText>&nbsp;</p>

<p class=HeaderSep>&nbsp;</p>

</div>

</body>

</html>
